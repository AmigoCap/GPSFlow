<!DOCTYPE html>

<head>
	<html lang="en">
	<meta charset="utf-8">
	<title>GPSFlow</title>
	<link rel="icon" type="image/JPG" href="d3/favicon.png" />
	<script src="d3/d3.js"></script>
	<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
	<style>
		body {
			padding: 0px;
			margin: 0px;
		}

		#heat_map,
		#google_maps,
		#resume_day {
			margin: 8px;
		}

		.month {
			margin-right: 8px;
		}

		.month-name {
			font-size: 85%;
			fill: #777;
			font-family: Arial, Helvetica;
		}

		.year-name {
			font-size: 200%;
			fill: #777;
			font-family: Arial, Helvetica;
		}

		.arrow {
			cursor: pointer;
		}

		.day {
			cursor: pointer;
		}

		.day.hover {
			stroke: #6d6E70;
			stroke-width: 2;
		}

		.day.focus {
			stroke: #ffff33;
			stroke-width: 2;
		}

		ul {
			list-style-type: none;
			margin: 0;
			padding: 8px;
			overflow: hidden;
			background-color: #023858;
		}

		li {
			float: left;
		}

		.active {
			background-color: #4CAF50;
		}

		.custom-file-upload {
			border-radius: 5px;
			border: none;
			fill: #076AA4;
			background-color: #076AA4;
			font: 14px sans-serif;
			font-weight: bold;
			color: white;
			display: inline-block;
			padding: 8px 12px;
			margin-right: 10px;
			cursor: pointer;
		}

		input[type="file"] {
			display: none;
		}

		.custom-about {
			border-radius: 5px;
			border: none;
			fill: #076AA4;
			background-color: #076AA4;
			font: 14px sans-serif;
			color: white;
			font-weight: bold;
			padding: 8px 12px;
			cursor: pointer;
		}

		.modal {
			display: none;
			/* Hidden by default */
			position: fixed;
			/* Stay in place */
			z-index: 1;
			/* Sit on top */
			padding-top: 100px;
			/* Location of the box */
			left: 0;
			top: 0;
			width: 100%;
			/* Full width */
			height: 100%;
			/* Full height */
			overflow: auto;
			/* Enable scroll if needed */
			background-color: rgb(0, 0, 0);
			/* Fallback color */
			background-color: rgba(0, 0, 0, 0.4);
			/* Black w/ opacity */
		}

		/* Modal Content */

		.modal-content {
			background-color: #fefefe;
			font: 16px sans-serif;
			margin: auto;
			padding: 20px;
			border: 1px solid #888;
			width: 30%;
		}

		/* The Close Button */

		.close {
			color: #aaaaaa;
			float: right;
			font-size: 28px;
			font-weight: bold;
		}

		.close:hover,
		.close:focus {
			color: #000;
			text-decoration: none;
			cursor: pointer;
		}

		.title {
			color: white;
			font: 30px sans-serif;
			font-weight: bold;
		}

		#tooltip {
			background-color: #fff;
			border: 2px solid #ccc;
			padding: 10px;
		}

		#map {
			height: 100%;
		}

	</style>
</head>

<body>
	<div>
		<ul>
			<li class="title">GPS Flow</li>
			<li class="nav-item" style="float:right">
				<button type="button" class="custom-about" id="myBtn">
					About
				</button>
			</li>
			<li style="float:right">
				<input id="file" type="file" name="file" class="inputfile" onchange="read(this.files)">
				<label for="file" class="custom-file-upload">Use your own file</label>
			</li>
		</ul>
		<div id="heat_map" style="display: inline-block; vertical-align:top;"></div>
		<div id="google_maps" style="display: inline-block; vertical-align:top; "></div>
		<div id="resume_day" style="display: inline-block;"></div>
	</div>

	<!-- The Modal -->
	<div id="myModal" style="overflow: scroll;" class="modal">

		<!-- Modal content -->
		<div class="modal-content">
			<span class="close">&times;</span>
			<p>
				<br> Authors :
				<a href="https://github.com/MathReynaud"> Mathilde Reynaud </a> |
				<a href="https://github.com/thalkz"> Roland Lamidieu</a> |
				<a href="https://github.com/alexandrospopov"> Alexandre Popov </a> |
				<a href="https://github.com/FrancoisPgm"> Fran√ßois Paugam </a> |
				<a href="https://github.com/Skan0394"> Skander Malouche </a>
				</br>

			</p>
			<h2> What is this project about ?</h2>

		</div>

	</div>
	<script>

		// Define stuff
		{
			var reader;
			var json;
		}

		// Define div, svg, etc..
		{
			//D3 elements
			var div_title = d3.select('#title')
			var div_heat_map = d3.select('#heat_map')
			var div_google_maps = d3.select('#google_maps')
			var div_resume_day = d3.select('#resume_day')

			//JS Elements
			var div_title_2 = document.getElementById('title')
			var div_heat_map_2 = document.getElementById('heat_map')
			var div_google_maps_2 = document.getElementById('google_maps')
			var div_resume_day_2 = document.getElementById('resume_day')
		}

		//Define margins, heights and widths
		{
			//Heat map
			var margin1 = {
				top: 10,
				right: 20,
				bottom: 20,
				left: 20,
			};
			//Google maps
			var margin2 = {
				top: 10,
				right: 20,
				bottom: 30,
				left: 40,
			};
			// Resume Day
			var margin3 = {
				top: 60,
				right: 60,
				bottom: 50,
				left: 40,
			};

			var width = window.innerWidth;
			var height = window.innerHeight;

			// Set heights
			var first_row_height = (height * 0.20) + "px";
			var second_row_height = (height * 0.80) + "px";

			div_heat_map_2.style.height = first_row_height;
			div_google_maps_2.style.height = second_row_height;
			div_resume_day_2.style.height = second_row_height;

			// Set widths
			var first_col_width = "100%";
			var second_col_width = "100%";
			var third_col_width = "0%"

			div_heat_map_2.style.width = first_col_width;
			div_google_maps_2.style.width = second_col_width;
			div_resume_day_2.style.width = third_col_width;

			var w1 = div_heat_map_2.clientWidth - margin1.left - margin1.right;
			var h1 = div_heat_map_2.clientHeight - margin1.top - margin1.bottom;
			var w2 = div_google_maps_2.clientWidth - margin2.left - margin2.right;
			var h2 = div_google_maps_2.clientHeight - margin2.top - margin2.bottom;
			var w3 = div_resume_day_2.clientWidth - margin3.left - margin3.right;
			var h3 = div_resume_day_2.clientHeight - margin3.top - margin3.bottom;

		}

		// Defin the About pop up
		{
			// Get the modal
			var modal = document.getElementById('myModal');

			// Get the button that opens the modal
			var btn = document.getElementById("myBtn");

			// Get the <span> element that closes the modal
			var span = document.getElementsByClassName("close")[0];

			// When the user clicks the button, open the modal
			btn.onclick = function () {
				modal.style.display = "block";
			}

			// When the user clicks on <span> (x), close the modal
			span.onclick = function () {
				modal.style.display = "none";
			}

			// When the user clicks anywhere outside of the modal, close it
			window.onclick = function (event) {
				if (event.target == modal) {
					modal.style.display = "none";
				}
			}
		}

		// Define div, svg, etc..
		{
			var body = d3.select("body");

			var tooltip = body
				.append("div").attr("id", "tooltip")
				.style("position", "absolute")
				.style("z-index", "10")
				.style("visibility", "hidden")
				.text("a simple tooltip");

			/*  var heat_map = div_heat_map
				  .append("svg")
				  .attr("height", (h1 + margin1.top + margin1.bottom))
				  .attr("width", (w1 + margin1.left + margin1.right)); */

			// var google_maps = div_google_maps
			// 	.append("svg")
			// 	.attr("height", (h2 + margin2.top + margin2.bottom))
			// 	.attr("width", (w2 + margin2.left + margin2.right));

			var resume_day = div_resume_day
				.append("svg")
				.attr("height", (h3 + margin3.top + margin3.bottom))
				.attr("width", (w3 + margin3.left + margin3.right));
		}

		//Define parsers
		{
			var parseUTCDateHour = d3.timeParse("%Y-%m-%dT%H:%M%Z");
			var parseUTCDate = d3.timeParse("%Y-%m-%d");
			var parseUTCDate2 = d3.timeParse("%W-%m-%Y");
			var parseUTCDate_time = d3.timeParse("%Y-%m-%d-%H-%M");
		}


		// Define colors
		{
			var color_selected = "#2c7bb6";
			var color_unselected = "#A0A0A0";
			var color_received = "#00ccbc";
			var color_sent = "#2c7bb6";
		}


        var map;
        var aPaths=[];
        var aColors=['#228B22','#FFA500','#FF0000'];
        var aMarkers=[];


		function read(file) {
			reader = new FileReader();
			reader.onloadend = assign_file;
			reader.readAsText(file[0])
		}

		function assign_file() {
			json = JSON.parse(reader.result);
			var min_year = d3.min(json.days, function (d) { return d.date.substr(6, 10) })
			update(min_year);
		}

		d3.json("d3/output.json", load_demo)

		function load_demo(json_file) {
			json = json_file;
			var min_year = d3.min(json.days, function (d) { return d.date.substr(6, 10) })
			main(min_year);
		}

		function main(year) {
			draw_selector_calendar(year);
			drawCalendar(year);
		}

		function update(year) {
			div_heat_map.selectAll(".month").remove();
			div_heat_map.selectAll(".selector").remove();
			draw_selector_calendar(year);
			drawCalendar(year);
		}

		function draw_selector_calendar(year) {
			var min_year = d3.min(json.days, function (d) { return d.date.substr(6, 10) })
			var max_year = d3.max(json.days, function (d) { return d.date.substr(6, 10) })

			var current_year = year

			var height = h1 / 5
			var width = (w1 / 51)

			var svg = div_heat_map.append("svg")
				.attr("class", "selector")
				.attr("height", h1)
				.attr("width", (w1 / 17) * 1.5)

			year_display = svg.append("text")
				.attr('x', width * 2)
				.attr('y', h1 / 3)
				.attr("text-anchor", "middle")
				.attr("class", "year-name")
				.text(current_year)


			var before = svg.append("g")
				.attr("transform", "translate(" + width * 2 + "," + h1 / 2 + ")")
				.append("path")
				.attr("d", "M 0 " + 0 + " L " + 0 + " " + (height) + "L " + (-width) + " " + (height / 2) + " Z")
				.attr("class", "arrow")
				.style("fill", "#023858")
				.on('click', function () {
					if ((current_year - 1) >= min_year) {
						current_year = +current_year - 1
						div_heat_map.selectAll(".month").remove();
						drawCalendar(current_year)
						year_display.text(current_year)
					}
				});

			var after = svg.append("g")
				.attr("transform", "translate(" + (width * 2 + 10) + "," + h1 / 2 + ")")
				.append("path")
				.attr("d", "M 0 " + 0 + " L " + 0 + " " + (height) + "L " + (width) + " " + (height / 2) + " Z")
				.attr("class", "arrow")
				.style("fill", "#023858")
				.on('click', function () {
					if ((current_year + 1) <= max_year) {
						current_year = +current_year + 1
						div_heat_map.selectAll(".month").remove();
						drawCalendar(current_year)
						year_display.text(current_year)
					}
				})

		}

		function drawCalendar(year) {

			var weeksInMonth = function (month) {
				var m = d3.timeMonth.floor(month)
				return d3.timeWeeks(d3.timeWeek.floor(m), d3.timeMonth.offset(m, 1)).length;
			}

			var minDate = new Date(+year, 0, 1)
			var maxDate = new Date(+year, 11, 31)

			var cellMargin = 2,
				cellSize = (w1) / (17 * 5);

			var day = d3.timeFormat("%w"),
				week = d3.timeFormat("%U"),
				format = d3.timeFormat("%d-%m-%Y"),
				titleFormat = d3.utcFormat("%a, %d-%b");
			monthName = d3.timeFormat("%B"),
				months = d3.timeMonth.range(d3.timeMonth.floor(minDate), maxDate);

			var svg = div_heat_map.selectAll(".month")
				.data(months)
				.enter().append("svg")
				.attr("class", "month")
				.attr("height", ((cellSize * 7) + (cellMargin * 8) + 20)) // the 20 is for the month labels
				.attr("width", function (d) {
					var columns = weeksInMonth(d);
					return ((cellSize * columns) + (cellMargin * (columns + 1)));
				})
				.append("g")

			svg.append("text")
				.attr("class", "month-name")
				.attr("y", (cellSize * 7) + (cellMargin * 8) + 15)
				.attr("x", function (d) {
					var columns = weeksInMonth(d);
					return (((cellSize * columns) + (cellMargin * (columns + 1))) / 2);
				})
				.attr("text-anchor", "middle")
				.text(function (d) { return monthName(d); })

			var rect = svg.selectAll("rect.day")
				.data(function (d, i) { return d3.timeDays(d, new Date(d.getFullYear(), d.getMonth() + 1, 1)); })
				.enter().append("rect")
				.attr("class", "day")
				.attr("width", cellSize)
				.attr("height", cellSize)
				.attr("rx", 3).attr("ry", 3) // rounded corners
				.attr("fill", '#eaeaea') // default light grey fill
				.attr("y", function (d) { return (day(d) * cellSize) + (day(d) * cellMargin) + cellMargin; })
				.attr("x", function (d) { return ((week(d) - week(new Date(d.getFullYear(), d.getMonth(), 1))) * cellSize) + ((week(d) - week(new Date(d.getFullYear(), d.getMonth(), 1))) * cellMargin) + cellMargin; })
				.on("mouseover", function (d) {
					d3.select(this).classed('hover', true);

					tooltip.style("visibility", "visible");
					tooltip.transition()
						.duration(200)
						.style("opacity", .9);
					tooltip.html(d)
						.style("left", (d3.event.pageX) + 30 + "px")
						.style("top", (d3.event.pageY) + "px");
				})
				.on("mouseout", function (d) {
					d3.select(this).classed('hover', false);
					tooltip.transition()
						.duration(500)
						.style("opacity", 0);
				})
				.datum(format);

			rect.append("title")
				.text(function (d) { return titleFormat(new Date(d)); });


			var scale = d3.scaleLinear()
				.domain(d3.extent(json.days, function (d) { return d.points_count; }))
				.range([0.4, 1]); // the interpolate used for color expects a number in the range [0,1] but i don't want the lightest part of the color scheme

			json.days.forEach(function (d) {
				rect.filter(function (e) { return e == d.date; })
					.style("fill", d3.interpolatePuBu(scale(d.points_count)))
					.select("title")
					.text("hello");
			})
		}

        function initMap() {
            map = new google.maps.Map(document.getElementById('google_maps'), {
                zoom: 13,
                center: {lat: 45.74793377391304, lng: 4.829102304347825},
                mapTypeId: 'terrain'
            });

            var dayData= [{ "date" : "28-09-2017", "points_count" : 91,"segments" : [
                    { "segment_id" : 0, "points" :
                            [{"numSC":0,"ts":"1506623178000","lat":45.7481706,"lng":4.8289398,"speed":0},
                                {"numSC":0,"ts":"1506623162000","lat":45.74844,"lng":4.8285813,"speed":0},
                                {"numSC":0,"ts":"1506623143000","lat":45.7485892,"lng":4.8285662,"speed":0},
                                {"numSC":0,"ts":"1506623104700","lat":45.7485892,"lng":4.8283624,"speed":0},
                                {"numSC":0,"ts":"1506623095100","lat":45.7486056,"lng":4.8279821,"speed":0},
                                {"numSC":0,"ts":"1506623079107","lat":45.7486882,"lng":4.8277604,"speed":0}]
                    },
                    { "segment_id" : 1, "points" :
                            [{"numSC":0,"ts":"1506623000700","lat":45.7488973,"lng":4.8272544,"speed":1},
                                {"numSC":0,"ts":"1506622985107","lat":45.7489785,"lng":4.8269855,"speed":1},
                                {"numSC":0,"ts":"1506622945707","lat":45.7597782,"lng":4.8268171,"speed":1},
                                {"numSC":0,"ts":"1506622266847","lat":45.760037,"lng":4.8258987,"speed":1},
                                {"numSC":1,"ts":"1506622226539","lat":45.7597782,"lng":4.8263159,"speed":0},
                                {"numSC":1,"ts":"1506622205090","lat":45.7601668,"lng":4.8265596,"speed":0},
                                {"numSC":1,"ts":"1506622183696","lat":45.7602686,"lng":4.8265664,"speed":0},
                                {"numSC":1,"ts":"1506622155700","lat":45.7607217,"lng":4.8266696,"speed":0},
                                {"numSC":1,"ts":"1506622122860","lat":45.7607548,"lng":4.8266696,"speed":0},
                                {"numSC":1,"ts":"1506622101331","lat":45.7610494,"lng":4.8266696,"speed":0},
                                {"numSC":1,"ts":"1506622081142","lat":45.7614994,"lng":4.8264181,"speed":0}]
                    },
                    { "segment_id" : 2, "points" :
                            [{"numSC":0,"ts":"1506607056000","lat":45.7616757,"lng":4.8267934,"speed":0},
                                {"numSC":0,"ts":"1506606995723","lat":45.761134,"lng":4.8266209,"speed":0},
                                {"numSC":0,"ts":"1506606959286","lat":45.7611002,"lng":4.8265573,"speed":0},
                                {"numSC":0,"ts":"1506606939225","lat":45.7609233,"lng":4.8265573,"speed":0},
                                {"numSC":0,"ts":"1506606917862","lat":45.7607341,"lng":4.8265573,"speed":0},
                                {"numSC":0,"ts":"1506606900775","lat":45.7602299,"lng":4.8265688,"speed":0},
                                {"numSC":0,"ts":"1506606880685","lat":45.7602299,"lng":4.8265573,"speed":0},
                                {"numSC":0,"ts":"1506606864346","lat":45.7602299,"lng":4.8263817,"speed":0},
                                {"numSC":0,"ts":"1506606596938","lat":45.7669487,"lng":4.8055096,"speed":0},
                                {"numSC":0,"ts":"1506606527826","lat":45.7669487,"lng":4.8055003,"speed":0},
                                {"numSC":0,"ts":"1506606325122","lat":45.7669487,"lng":4.8050776,"speed":0},
                                {"numSC":1,"ts":"1506606285043","lat":45.7658002,"lng":4.8013041,"speed":1},
                                {"numSC":1,"ts":"1506606265026","lat":45.7654914,"lng":4.8010209,"speed":1},
                                {"numSC":1,"ts":"1506606244306","lat":45.7654914,"lng":4.8001218,"speed":1},
                                {"numSC":1,"ts":"1506606224269","lat":45.7658002,"lng":4.7998386,"speed":1},
                                {"numSC":1,"ts":"1506606184197","lat":45.7685513,"lng":4.7979551,"speed":1},
                                {"numSC":1,"ts":"1506606164191","lat":45.7739563,"lng":4.7976143,"speed":1},
                                {"numSC":1,"ts":"1506606144186","lat":45.7739563,"lng":4.797012,"speed":1},
                                {"numSC":1,"ts":"1506606083563","lat":45.7739563,"lng":4.7965169,"speed":1},
                                {"numSC":2,"ts":"1506606063528","lat":45.7737451,"lng":4.7947841,"speed":0},
                                {"numSC":2,"ts":"1506606021176","lat":45.7735902,"lng":4.7946785,"speed":0},
                                {"numSC":2,"ts":"1506606001354","lat":45.7735902,"lng":4.794523,"speed":0},
                                {"numSC":2,"ts":"1506605980145","lat":45.7735691,"lng":4.794523,"speed":0},
                                {"numSC":3,"ts":"1506605959961","lat":45.7735395,"lng":4.7937395,"speed":1},
                                {"numSC":3,"ts":"1506605919889","lat":45.7735342,"lng":4.7927932,"speed":1},
                                {"numSC":3,"ts":"1506605858837","lat":45.7735342,"lng":4.7918459,"speed":1},
                                {"numSC":3,"ts":"1506605819277","lat":45.7729046,"lng":4.7914144,"speed":1},
                                {"numSC":3,"ts":"1506605798743","lat":45.7729046,"lng":4.7888632,"speed":1},
                                {"numSC":3,"ts":"1506605657546","lat":45.7736708,"lng":4.7836125,"speed":1},
                                {"numSC":3,"ts":"1506605597452","lat":45.774277,"lng":4.7820606,"speed":1},
                                {"numSC":3,"ts":"1506605577688","lat":45.7744612,"lng":4.7790971,"speed":1},
                                {"numSC":3,"ts":"1506605557326","lat":45.7745171,"lng":4.7788653,"speed":1},
                                {"numSC":3,"ts":"1506605517265","lat":45.7745525,"lng":4.7779587,"speed":1},
                                {"numSC":3,"ts":"1506605497305","lat":45.7747091,"lng":4.7771127,"speed":1},
                                {"numSC":3,"ts":"1506605477183","lat":45.7750692,"lng":4.7759369,"speed":1},
                                {"numSC":3,"ts":"1506605457120","lat":45.7751145,"lng":4.775173,"speed":1},
                                {"numSC":3,"ts":"1506605417098","lat":45.7765578,"lng":4.7736698,"speed":1},
                                {"numSC":3,"ts":"1506605396923","lat":45.7775847,"lng":4.7698134,"speed":1},
                                {"numSC":3,"ts":"1506605269548","lat":45.7829591,"lng":4.7663864,"speed":1},
                                {"numSC":3,"ts":"1506605249541","lat":45.7835351,"lng":4.7663864,"speed":1},
                                {"numSC":3,"ts":"1506605168468","lat":45.784125,"lng":4.7662879,"speed":1},
                                {"numSC":3,"ts":"1506605146877","lat":45.7844199,"lng":4.7662879,"speed":1},
                                {"numSC":3,"ts":"1506605045398","lat":45.7849988,"lng":4.7651705,"speed":1}]
                    },
                    { "segment_id" : 3, "points" :
                            [{"numSC":0,"ts":"1506593727676","lat":45.7829918,"lng":4.7670493,"speed":0},
                                {"numSC":0,"ts":"1506593708081","lat":45.7835686,"lng":4.7670315,"speed":0},
                                {"numSC":0,"ts":"1506593687269","lat":45.7836426,"lng":4.7670315,"speed":0},
                                {"numSC":0,"ts":"1506593567017","lat":45.7836619,"lng":4.7670493,"speed":0},
                                {"numSC":0,"ts":"1506593467228","lat":45.7838727,"lng":4.767318,"speed":0},
                                {"numSC":0,"ts":"1506593446648","lat":45.7838727,"lng":4.7675533,"speed":0},
                                {"numSC":0,"ts":"1506593386523","lat":45.7838727,"lng":4.7676037,"speed":0},
                                {"numSC":0,"ts":"1506593098894","lat":45.7829951,"lng":4.7676525,"speed":0},
                                {"numSC":0,"ts":"1506593038747","lat":45.7829951,"lng":4.7676525,"speed":0},
                                {"numSC":0,"ts":"1506593019014","lat":45.7829951,"lng":4.7676525,"speed":0},
                                {"numSC":0,"ts":"1506592917596","lat":45.7834784,"lng":4.7670285,"speed":0},
                                {"numSC":0,"ts":"1506592885112","lat":45.7835701,"lng":4.7670285,"speed":0},
                                {"numSC":0,"ts":"1506592807436","lat":45.7835882,"lng":4.7670285,"speed":0},
                                {"numSC":0,"ts":"1506592626938","lat":45.7835882,"lng":4.7670373,"speed":0},
                                {"numSC":0,"ts":"1506592504641","lat":45.7835882,"lng":4.7671024,"speed":0},
                                {"numSC":0,"ts":"1506592306090","lat":45.7835918,"lng":4.7671024,"speed":0},
                                {"numSC":0,"ts":"1506592265917","lat":45.7835918,"lng":4.7670785,"speed":0},
                                {"numSC":0,"ts":"1506592028938","lat":45.7835918,"lng":4.7671024,"speed":0},
                                {"numSC":0,"ts":"1506591945481","lat":45.7835918,"lng":4.7670993,"speed":0},
                                {"numSC":0,"ts":"1506591825151","lat":45.7835935,"lng":4.7670785,"speed":0},
                                {"numSC":0,"ts":"1506591682743","lat":45.7835935,"lng":4.7670785,"speed":0},
                                {"numSC":0,"ts":"1506591502591","lat":45.783604,"lng":4.7670847,"speed":0},
                                {"numSC":0,"ts":"1506591362281","lat":45.783604,"lng":4.7670847,"speed":0},
                                {"numSC":0,"ts":"1506590555826","lat":45.783604,"lng":4.7670816,"speed":0},
                                {"numSC":0,"ts":"1506590317989","lat":45.7835595,"lng":4.7671093,"speed":0},
                                {"numSC":0,"ts":"1506589991120","lat":45.7835856,"lng":4.7670816,"speed":0}]}],
                "staypoints" :[{'lng': 4.829102304347825, 'addr': 'Unknown', 'lat': 45.74793377391304, 'end': '1506623162000', 'start': '1506635980080', 'label': 0},
                    {'lng': 4.82742692, 'addr': 'Unknown', 'lat': 45.74879886, 'end': '1506622985107', 'start': '1506623079107', 'label': 1},
                    {'lng': 4.826616379487179, 'addr': 'Unknown', 'lat': 45.7618741526923, 'end': '1506620347958', 'start': '1506622081142', 'label': 2},
                    {'lng': 4.826616379487179, 'addr': 'Unknown', 'lat': 45.7618741526923, 'end': '1506606995723', 'start': '1506620347958', 'label': 2},
                    {'lng': 4.764863666964286, 'addr': 'Unknown', 'lat': 45.78501842232144, 'end': '1506597619030', 'start': '1506605045398', 'label': 3},
                    {'lng': 4.7681230999999995, 'addr': 'Unknown', 'lat': 45.78299907222222, 'end': '1506593727676', 'start': '1506597434291', 'label': 4}]}]

            nbSeg=dayData[0].segments.length;
            for (ii=0; ii<nbSeg; ii++){
                maxSC=Math.max.apply(Math,dayData[0].segments[ii].points.map(function(o){return o.numSC;}))
                backGroundPath = new google.maps.Polyline({
                    path: dayData[0].segments[ii].points,
                    strokeColor: aColors[1],
                    strokeOpacity: 1.0,
                    strokeWeight: 2
                });
                aPaths.push(backGroundPath)
                for(jj=0;jj<=maxSC;jj++){
                    dataToDraw=dayData[0].segments[ii].points.filter(function(o){return o.numSC==jj});
                    colorToPlot=dataToDraw[0].speed;
                    path = new google.maps.Polyline({
                        path: dataToDraw ,
                        strokeColor: aColors[colorToPlot],
                        strokeOpacity: 1.0,
                        strokeWeight: 2
                    });
                    aPaths.push(path)
                }
            }



            for( ii=0;ii<dayData[0].staypoints.length;ii++){
                st=dayData[0].staypoints[ii];
                console.log(geocodeLatLng(new google.maps.Geocoder,st.lat,st.lng));
                marker = new google.maps.Marker({
                    position: {lat: st.lat, lng: st.lng},
                    title: 'Hello World!'});
                aMarkers.push(marker)
            }

            addMarker();
            addLine();

        }

        function geocodeLatLng(geocoder,lat,lng) {
            var latlng = {lat: lat, lng: lng};
            geocoder.geocode({'location': latlng}, function (results, status) {
                console.log('ici')
                if (status === 'OK') {
                    if (results[1]) {
                        console.log(results[1].formatted_address)

                        return (results[1].formatted_address);
                    } else {
                        return ('Adress not found')
                    }
                } else {
                    return ('Adress not found')
                }
            });
        }

        function addMarker(){
            for(i=0;i<aMarkers.length;i++) {
                aMarkers[i].setMap(map)
            }    }

        function addLine() {
            for(i=0;i<aPaths.length;i++) {
                aPaths[i].setMap(map)
            }
        }

        function removeLine() {
            for(i=0;i<aPaths.length;i++) {
                aPaths[i].setMap(null);
            }
            marker.setMap(null)

        }


	</script>
	<script async defer
			src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDsYwvF3UUxTx8RB40wd4SnUVzfnbW66LM&callback=initMap">
	</script>
</body>

</html>